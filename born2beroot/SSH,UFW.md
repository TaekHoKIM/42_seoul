# SSH
SSH : secure shell
두 컴퓨터가 통신을 하기 위해 사용되는 하나의 보안 protocol - 원격호스트에 접속하기 위한 보안 프로토콜
@protocol - 서로 다른 장치가 통신을 위해 주고 받는 데이터 양식 및 규칙

- ssh를 통한 통신은 암호화 되어 있음
- 기존에 telnet (통신 프로토콜)의 경우에는 보안이 없음 -> 중간에 데이터를 다 볼 수 있음

## SSH 작동원리
ssh는 키를 통해서 데이터를 암호화/복호화 해서 보안을 유지함

1. __대칭키(Symmetric Encryption)__ - 호스트와 게스트가 같은 키를 가지고 인증을 하는 방식 - secrete key를 서로 가지고 있음 -> 처음 secrete key를 보낼 때 보안의 문제도 있고, 호스트나 게스트에서 하나라도 key를 분실하면 보안이 문제가 됨
2. __비대칭 키(Asymmetric Encryption)__ - private key 와 public key를 가지고 인증하는 방식 -> 수신자는 public key를 송신자에게 보냄 ( 이거는 브로드하게 보냄 - 유출되도 상관 없음 ) -> 송신자는 해당 public key를 이용해 데이터를 암호화하고 수신자는 자신의 private key를 이용해 데이터를 복호화함
	=> 수신자에게 오는 데이터는 송신자가 수신자의 public key를 이용해 암호화한 것 -> 수신자는 암호화된 데이터를 자신만 가지고 있는 private key를 이용해서 복호화해서 사용
	=> 보안적으로 자신의 private key만 보안을 유지하면 데이터 보안을 유지할 수 있음
### 비대칭 키의 문제
pubic key를 이용해서 암호화 한 데이터를 private key를 통해 복호화하는 시간이 오래걸림 
-> 그래서 주로 대칭키를 주고 받을 때 비대칭키를 사용
-> 대칭키를 주고 받는 과정에서 보안의 문제를 비대칭키를 통해서 해결함

대표적인 비대칭 키 알고리즘 
1. Diffie-hellman 알고리즘 ( 이것은 대표적인 공개키 공유 알고리즘 )
2. RSA
3. DSA 등

## SSH 작동과정
[작동과정 관련](https://limvo.tistory.com/21)
1. 서버에 클라이언트가 접속 시도
2. 서버는 클라이언트에 공개키를 제공
3. 공개키를 받는 과정에서 각자의 private key가 생성됨 - 이를 통해서 통신
4. 클라이언트는 서버를 확인
5. 비대칭키를 이용해서 대칭키를 공유 ( 대칭키는 세션 이후에 폐기함 )
6. 서버도 클라이언트를 확인
7. 통신 - MAC(Message Authentication Code)은 항상 작동 ( 데이터 무결성을 위해 )
## 해시함수
송신자랑 수신자가 통신과정에서 ==데이터의 무결성==( 데이터에 변조가 없었는 지)을 입증하기 위해 해시도 같이 보냄
-> 송신자는 데이터 패킷의 정보나, 공개 키 데이터를 같이 이용해서 해시함수를 돌리고 이를 해시로 만들어서 같이 보냄 - 이 해시 값을 __MAC (Message Authentication Code)__ 이라고 함
-> 수신자도 해당 데이터 들을 해시를 통해서 돌려서  MAC의 값을 도출하고 이를 송신자의 MAC값과 비교해서 데이터의 무결성을 확인함

## Authentication (인증)
SSH 과정을 통해서 게스트와 호스트는 보안적으로 안정적인 통신상태가 된 것 -> 이후에 해당 게스트가 호스트에 접근 할 수 있는 지를 판단하는 과정
### 방법
1. 비밀번호 
2. RSA 방식 ( 공개키, 개인키 방식 ) - 게스트가 RSA 알고리즘에 따라 키 쌍( 개인키와 공개키 )을 생성하고  여기에서 공개키를 서버에 보냄 -> 서버에서는 해당 공개키를 접근 가능 리스트에 저장함
	=> 해당 클라이언트를 인증하는 과정
	1. 클라이언트는 메세지를 해시해서 해시 메세지를 만듦 ( 이것을 signature이라고 함)
	2. signature을 개인키로 암호화해서 암호문을 만듦
	3. 암호문을 처음 메세지와 함께 서버로 보냄
	4. 서버는 암호문을 공개키로 복호화하고 여기에서 나온 해시 메시지랑 따로 받은 메세지를 해시한 값을 비교해서 클라이언트를 인증

![](http://image.toast.com/aaaaahq/sign-and-verification.png)

# 사용
- [ssh 사용자이름@호스트주소] 로 접속 -> ssh john@example.com 와 같은 형태
- 기본적으로 TCP 22번 포트를 사용 -> 포트 지정시 [ssh -p 2222 user@example.com] 같은 명령어 사용
- 서버에서 특정 호스트에 대해서 특정 포트를 지정할 수도 있음
## openssh
- ssh와 관련된 주요 패키지는 ==openssh==
- openssh-server / openssh-client로 패키지가 구분되어 있음
=> server는 허용하는 패키지 / clinet는 전송하는 패키지로 구성되어 있음
- 그 외에 sshpass(ssh 자동로그인) / rsync( 백업 및 동기화 ) / keychain (ssh 키 관리) / mosh( 불안정한 환경속에서는 ssh 지원) 등이 관련된 패키지로 존재


# UFW
UFW - Uncomplicatied Firewall
-> 리눅스 시스템에서 사용하는 간단한 방화벽 관리도구

- 특정 포트를 열기 / 닫기
- 특정 IP 주소에 대한 엑세스 허용 / 거부 등 ( 추가적으로 프로토콜 등을 지정할 수도 있음)
=> 간단한 방화벽 관리 도구임